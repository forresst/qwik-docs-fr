---
title: Qwik City - Middleware de Netlify Edge
contributors:
  - adamdbradley
---

# Middleware de Netlify Edge

Le middleware de Qwik City pour Netlify Edge vous permet de connecter Qwik City à [Netlify Edge](https://docs.netlify.com/netlify-labs/experimental-features/edge-functions/).

## Ajout au projet Qwik

Exécutez cette commande pour intégrer netlify-edge à votre appli :

```bash
npm run qwik add netlify-edge
```

La commande précédente créera `src/entry.netlify-edge.tsx` en utilisant le middleware intégré dans l'appli d'un utilisateur.

## Ajout manuel de Netlify Edge

Si vous voulez ajouter Netilify Edge manuellement, vous pouvez ajouter ou modifier les fichiers comme ci-dessous :

`src/entry.netlify-edge.tsx`

```typescript
import { qwikCity } from '@builder.io/qwik-city/middleware/netlify-edge';
import render from './entry.ssr';

const qwikCityHandler = qwikCity(render);

export default qwikCityHandler;
```

`vite.config.ts`

```typescript
import { defineConfig } from "vite";
import { qwikVite } from "@builder.io/qwik/optimizer";
import { qwikCity } from "@builder.io/qwik-city/vite";
import tsconfigPaths from "vite-tsconfig-paths";
+import netlifyEdge from "@netlify/vite-plugin-netlify-edge";

export default defineConfig(() => {
  return {
    plugins: [
      qwikCity(),
      qwikVite({
+        ssr: {
+          outDir: "netlify/edge-functions",
+        },
      }),
      tsconfigPaths(),
+      netlifyEdge({
+        functionName: "entry.netlify-edge",
+      }),
    ],
  };
});
```

Configurez `netlify.toml`

```toml
[[edge_functions]]
path = "/*"
function = "entry.netlify-edge"
```

## Utilisation

Utilisez le CLI de Netlify pour prévisualiser ou déployer. [Lisez le guide complet ici](https://github.com/BuilderIO/qwik/blob/main/starters/servers/netlify-edge/README.md)

```bash
vite build --ssr src/entry.netlify-edge.tsx
netlify dev
```

### Contexte

Le [contexte Netlify](https://docs.netlify.com/edge-functions/api/#netlify-specific-context-object) est disponible dans le paramètre `platform` de la méthode du endpoint :

```javascript
export const onRequest = async ({ platform }) => {
  platform.log('requested ip:', platform.ip)
};
```

De plus, vous pouvez importer le type `RequestHandlerNetlify` pour avoir des compléments de type dans votre éditeur.

```typescript
import {type RequestHandlerNetlify} from '@builder.io/qwik-city/middleware/netlify-edge';
export const onGet: RequestHandlerNetlify = (({platform}) => {
 //...
})
```


### Variables d'environnement

```javascript
export const onRequest = async ({ platform }) => {
  platform.log('Vite env read from .dev file', import.meta.env.VITE_DEV)
  platform.log('netlify serverless env read from Netlify UI or CLI', Deno.env.toObject())
  return {}
};
```

- [Variables d'environnement de Netlify](https://docs.netlify.com/environment-variables/overview/#environment-variable-options)
- [Source du Middleware de Netlify Edge](https://github.com/BuilderIO/qwik/blob/main/packages/qwik-city/middleware/netlify-edge/index.ts)
